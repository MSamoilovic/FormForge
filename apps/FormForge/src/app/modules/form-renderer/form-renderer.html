@let formSchema = rendererService.schema();

@if (rendererService.loading()) {
  <div class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading form...</p>
  </div>
} @else if (formSchema) {
  <mat-card
    class="form-container"
    [style.--form-primary-color]="formSchema.theme?.primaryColor || '#3f51b5'"
    [style.--form-background-color]="formSchema.theme?.backgroundColor || '#ffffff'"
    [style.--form-text-color]="formSchema.theme?.textColor || '#000000'"
    [style.--form-font-family]="formSchema.theme?.fontFamily || 'Roboto, sans-serif'"
    [style.--form-border-radius]="formSchema.theme?.borderRadius || 8"
  >
    <mat-card-header>
      <mat-card-title>{{ formSchema?.name }}</mat-card-title>
      @if (formSchema?.description) {
        <mat-card-subtitle>{{ formSchema?.description }}</mat-card-subtitle>
      }
    </mat-card-header>
    <mat-card-content>
      @if (rendererService.formGroup(); as formGroup) {
        <form [formGroup]="formGroup" (ngSubmit)="onSubmit()" novalidate>

          @for (field of formSchema.fields; track field.id) {
            <div class="field-wrapper" [class.hidden]="formGroup.get(field.id)?.disabled">
              <ng-container
                [ngComponentOutlet]="getComponent(field.type)"
                [ngComponentOutletInputs]="getComponentInputs(field)"
              ></ng-container>

              @if (formGroup.get(field.id); as control) {
                @if (control.invalid && (control.touched || control.dirty)) {
                  <mat-error class="error-message">
                    @for (validation of field.validations; track validation.type) {
                      @if (control.hasError(validation.type.toLowerCase())) {
                        {{ validation.message }}
                      }
                    }
                  </mat-error>
                }
              }
            </div>
          }
          <button mat-raised-button color="primary" type="submit" class="submit-button">
            Submit
          </button>
        </form>
      }
    </mat-card-content>
  </mat-card>
} @else {
  <div class="error-container">
    <h2>Form Not Found</h2>
    <p>The form you are looking for could not be loaded.</p>
    <a mat-stroked-button routerLink="/dashboard">Go to Dashboard</a>
  </div>
}

